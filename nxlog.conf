#Define Hostname
define FUSION_HOST1 Datacenter.thaitsuzuki.co.th
define FUSION_HOST2 Secondary-AD.thaitsuzuki.co.th
define FUSION_HOST3 TTC-UTILITY
define FUSION_HOST4 TTC-SQLDB
define FUSION_HOST5 QuickBook-Server.thaitsuzuki.co.th
define FUSION_HOST6 FILESRV.thaitsuzuki.co.th
define FUSION_HOST7 PAYROLL-SERVER.thaitsuzuki.co.th
define FUSION_HOST8 SonicWall
define FUSION_PATH /home/syslog/FUSION_20153

#INPUT PORT
<Input FUSION_20153>
    Module      im_tcp
    Host        0.0.0.0
    Port        20153
    Exec        parse_syslog();
</Input>

#Filters Host
#Filters Host1 "Datacenter.thaitsuzuki.co.th"
<Processor filter_%FUSION_HOST1%>
    Module      pm_filter
    Condition   $raw_event =~ /Datacenter.thaitsuzuki.co.th/
</Processor>

#Filters Host2 "Secondary-AD.thaitsuzuki.co.th"
<Processor filter_%FUSION_HOST2%>
    Module      pm_filter
    Condition   $raw_event =~ /Secondary-AD.thaitsuzuki.co.th/
</Processor>

#Filters Host3 "TTC-UTILITY"
<Processor filter_%FUSION_HOST3%>
    Module      pm_filter
    Condition   $raw_event =~ /TTC-UTILITY/
</Processor>

#Filters Host4 "TTC-SQLDB"
<Processor filter_%FUSION_HOST4%>
    Module      pm_filter
    Condition   $raw_event =~ /TTC-SQLDB/
</Processor>

#Filters Host5 "QuickBook-Server.thaitsuzuki.co.th"
<Processor filter_%FUSION_HOST5%>
    Module      pm_filter
    Condition   $raw_event =~ /QuickBook-Server.thaitsuzuki.co.th/
</Processor>

#Filters Host6 "FILESRV.thaitsuzuki.co.th"
<Processor filter_%FUSION_HOST6%>
    Module      pm_filter
    Condition   $raw_event =~ /FILESRV.thaitsuzuki.co.th/
</Processor>

#Filters Host7 "PAYROLL-SERVER.thaitsuzuki.co.th"
<Processor filter_%FUSION_HOST7%>
    Module      pm_filter
    Condition   $raw_event =~ /PAYROLL-SERVER.thaitsuzuki.co.th/
</Processor>

#Filters Host8 "SonicWall"
<Processor filter_%FUSION_HOST8%>
    Module      pm_filter
    Condition   $raw_event =~ /SonicWall/
</Processor>

#Output Log Template
<Output fileout_%FUSION_HOST1%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST1%" + "/" + "%FUSION_HOST1%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST2%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST2%" + "/" + "%FUSION_HOST2%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST3%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST3%" + "/" + "%FUSION_HOST3%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST4%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST4%" + "/" + "%FUSION_HOST4%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST5%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST5%" + "/" + "%FUSION_HOST5%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST6%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST6%" + "/" + "%FUSION_HOST6%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST7%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST7%" + "/" + "%FUSION_HOST7%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileout_%FUSION_HOST8%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST8%" + "/" + "%FUSION_HOST8%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

#Route Archive
<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST1% => fileout_%FUSION_HOST1%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST2% => fileout_%FUSION_HOST2%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST3% => fileout_%FUSION_HOST3%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST4% => fileout_%FUSION_HOST4%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST5% => fileout_%FUSION_HOST5%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST6% => fileout_%FUSION_HOST6%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST7% => fileout_%FUSION_HOST7%
</Route>

<Route FUSION>
    Path       FUSION_20153 => filter_%FUSION_HOST8% => fileout_%FUSION_HOST8%
</Route>

#Output To SIEM
<Output ERC2_FUSION_Windows>
    Module  om_udp
    Host    10.11.100.131
    Port    20153
</Output>

<Output ERC2_FUSION_SonicWall>
    Module  om_udp
    Host    10.11.100.131
    Port    20154
</Output>

#Input Log FUSION
<Input FUSION_%FUSION_HOST1%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST1%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST2%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST2%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST3%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST3%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST4%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST4%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST5%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST5%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST6%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST6%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST7%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST7%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST8%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST8%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>


#Route Log Windows to ERC2 port 20153 
<Route forwardLog>
    Path      %FUSION_HOST1%,%FUSION_HOST2%,%FUSION_HOST3%,%FUSION_HOST4%,%FUSION_HOST5%,%FUSION_HOST6%,%FUSION_HOST7%,%FUSION_HOST8%  => ERC2_FUSION_Windows
</Route>    

#Route Log SonicWall to ERC2 port 20154 
<Route forwardLog>
    Path      %FUSION_HOST1%,%FUSION_HOST2%,%FUSION_HOST3%,%FUSION_HOST4%,%FUSION_HOST5%,%FUSION_HOST6%,%FUSION_HOST7%,%FUSION_HOST8%  => ERC2_FUSION_SonicWall
</Route>    

