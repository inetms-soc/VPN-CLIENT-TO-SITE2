#Define Hostname 
define FUSION_HOST1 Datacenter.thaitsuzuki.co.th
define FUSION_HOST2 Secondary-AD.thaitsuzuki.co.th
define FUSION_HOST3 TTC-UTILITY
define FUSION_HOST4 TTC-SQLDB
define FUSION_HOST5 QuickBook-Server.thaitsuzuki.co.th
define FUSION_HOST6 FILESRV.thaitsuzuki.co.th
define FUSION_HOST7 PAYROLL-SERVER.thaitsuzuki.co.th
define FUSION_HOST8 SonicWall
define FUSION_PATH /home/syslog/FUSION_20153

#INPUT PORT
<Input FUSION_20153>
    Module      im_tcp
    Host        0.0.0.0
    Port        20153
    Exec        parse_syslog();
</Input>

#Filters Host
<Processor filter_%FUSION_HOST1%>
    Module      pm_filter
    Condition   $raw_event =~ /Datacenter.thaitsuzuki.co.th/
</Processor>

<Processor filter_%FUSION_HOST2%>
    Module      pm_filter
    Condition   $raw_event =~ /Secondary-AD.thaitsuzuki.co.th/
</Processor>

<Processor filter_%FUSION_HOST3%>
    Module      pm_filter
    Condition   $raw_event =~ /TTC-UTILITY/
</Processor>

<Processor filter_%FUSION_HOST4%>
    Module      pm_filter
    Condition   $raw_event =~ /TTC-SQLDB/
</Processor>

<Processor filter_%FUSION_HOST5%>
    Module      pm_filter
    Condition   $raw_event =~ /QuickBook-Server.thaitsuzuki.co.th/
</Processor>

<Processor filter_%FUSION_HOST6%>
    Module      pm_filter
    Condition   $raw_event =~ /FILESRV.thaitsuzuki.co.th/
</Processor>

<Processor filter_%FUSION_HOST7%>
    Module      pm_filter
    Condition   $raw_event =~ /PAYROLL-SERVER.thaitsuzuki.co.th/
</Processor>

<Processor filter_%FUSION_HOST8%>
    Module      pm_filter
    Condition   $raw_event =~ /id=firewall/
</Processor>

#Output Log Template Fusion
<Output fileOut_%FUSION_HOST1%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST1%" + "/" + "%FUSION_HOST1%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST2%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST2%" + "/" + "%FUSION_HOST2%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST3%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST3%" + "/" + "%FUSION_HOST3%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST4%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST4%" + "/" + "%FUSION_HOST4%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST5%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST5%" + "/" + "%FUSION_HOST5%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST6%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST6%" + "/" + "%FUSION_HOST6%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST7%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST7%" + "/" + "%FUSION_HOST7%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

<Output fileOut_%FUSION_HOST8%>
    CreateDir TRUE
    Module      om_file
    File        "%FUSION_PATH%" + "/" + "%FUSION_HOST8%" + "/" + "%FUSION_HOST8%" + "-" + strftime(now(), "%Y-%m-%d-%H") + ".log"
</Output>

#Route Archive
<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST1% => fileOut_%FUSION_HOST1%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST2% => fileOut_%FUSION_HOST2%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST3% => fileOut_%FUSION_HOST3%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST4% => fileOut_%FUSION_HOST4%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST5% => fileOut_%FUSION_HOST5%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST6% => fileOut_%FUSION_HOST6%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST7% => fileOut_%FUSION_HOST7%
</Route>

<Route Fusion>
    Path       FUSION_20153 => filter_%FUSION_HOST8% => fileOut_%FUSION_HOST8%
</Route>

#Output To SIEM 
<Output ERC2_Fusion_Windows>
    Module  om_udp
    Host    10.11.100.131
    Port    20153
</Output>

<Output ERC2_Fusion_SonicWall>
    Module  om_udp
    Host    10.11.100.131
    Port    20154
</Output>

#Input Log Fusion
<Input FUSION_%FUSION_HOST1%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST1%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST2%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST2%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST3%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST3%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST4%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST4%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST5%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST5%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST6%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST6%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST7%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST7%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

<Input FUSION_%FUSION_HOST8%>
    Module      im_file
    File        "%FUSION_PATH%/%FUSION_HOST8%/*.log"
    SavePos     TRUE
    ReadFromLast TRUE
    PollInterval 1
    Exec        parse_syslog();
</Input>

# Route Log To SIEM ERC2
<Route forwardLog>
    Path       FUSION_%FUSION_HOST1%,FUSION_%FUSION_HOST2%,FUSION_%FUSION_HOST3%,FUSION_%FUSION_HOST4%,FUSION_%FUSION_HOST5%,FUSION_%FUSION_HOST6%,FUSION_%FUSION_HOST7% => ERC2_Fusion_Windows
</Route>

<Route forwardLog>
    Path       FUSION_%FUSION_HOST8% => ERC2_Fusion_SonicWall
</Route>    